<app-header [user]="user"
            [downloadMatchingStatus]="downloadMatchingStatus"
            [downloadPatientsStatus]="downloadPatientsStatus"
            (downloadPatientsAction)="downloadPatientsXlsxReport()"
            [txmEvents]="txmEvents"
            [defaultTxmEvent]="defaultTxmEvent"
            (defaultTxmEventSelected)="setDefaultTxmEvent($event)"
            [loading]="loading"></app-header>

<section class="patients">
  <app-container>
    <div class="patients__header">
      <h1>
        Patients
        <app-count [count]="donorsCount + recipientCount"
                   title="Donors: {{donorsCount}}, Recipients: {{recipientCount}}">
        </app-count>
      </h1>
      <app-button (click)="togglePatientPopup()" variant="success" size="sm">
        add new
        <mat-icon>add</mat-icon>
      </app-button>
    </div>
  </app-container>

  <app-template-popup [isOpened]="patientPopupOpened"
                      [title]="'Add new patient pair'"
                      (wasClosed)="togglePatientPopup()">
    <app-add-new-patient *ngIf="patientPopupOpened" [defaultTxmEvent]="defaultTxmEvent" (addPatientsClicked)="addPatientPair($event)"></app-add-new-patient>
  </app-template-popup>

  <app-content>
    <h3 *ngIf="!loading && !items.length">No patients were found.</h3>
    <app-item-list *ngIf="!loading && items.length"
                   [items]="items"
                   [active]="activeItem"
                   [configuration]="configuration"
                   [patients]="patients"
                   [saveLastViewedItem]="true"
                   [useInfiniteScroll]="false"
                   [defaultTxmEvent]="defaultTxmEvent"></app-item-list>

    <div *ngIf="!loading && items.length" class="item-list">
      <div class="list">
        <div #list class="list-inner" [class.smooth-scroll]="enableSmoothScroll">
          <app-new-item *ngFor="let item of displayedItems; trackBy: trackListItem"
                        [item]="item"
                        (click)="handleItemClick(item)"
                        [isActive]="item === activeItem">
            <!-- TODO: create separate lists of donors and pairs -->
            <!--            <app-patient-pair-item *ngIf=""></app-patient-pair-item>-->
          </app-new-item>
        </div>
      </div>
      <div class="detail">
        <div [class.aligned-bottom]="activeAlignedBottom"
             [class.aligned-top]="activeAlignedTop"
             [class]="scrollableDetailClass"
             #detail
             cdk-scrollable>
          <!--          <app-matching-detail [item]="activeItem"-->
          <!--                               [configuration]="configuration"-->
          <!--                               [patients]="patients"></app-matching-detail>-->
        </div>
      </div>
    </div>
  </app-content>
</section>

<app-alert></app-alert>
<app-loading [show]="loading"></app-loading>
